<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DAY02 lista n√©zet</title>

  <link rel="stylesheet" href="../assets/css/style.css">

  <!-- DAY02 h√°tt√©r -->
  <style>
    body.day02 {
      background: url("images/Traunsee.jpg") center / cover no-repeat fixed;
    }

    /* sz√∂vegdoboz h√°tt√©r picit s√∂t√©tebb */
    .card{
      background: rgba(0,0,0,0.72);
    }
  </style>
</head>

<body class="day02">
<div class="page">

  <!-- TOPBAR -->
  <div class="topbar">
    <div class="inner">
      <div class="brand">
        <div class="title">K√©k Duna t√∫ra</div>
        <div class="subtitle">DAY02 lista n√©zet</div>
      </div>
      <div class="btnrow">
        <a class="btn" href="../index.html">üè† F≈ëoldal</a>
        <button class="btn btn-accent" id="btnNearest">üìå Legk√∂zelebbi pont</button>
      </div>
    </div>
  </div>

  <!-- CONTENT -->
  <div class="container">

    <div class="card">
      <div class="h1">DAY02 ‚Äì Wachau ‚Üí Salzkammergut ‚Üí Saalachtal</div>
      <div class="small">
        A m√©r√©s oldalnyit√°skor indul, majd 5 mp m√∫lva friss√ºl.
        Az oldal automatikusan a k√∂vetkez≈ë logikus pontra ugrik.
      </div>
      <div class="notice" id="gpsNotice" style="display:none">
        A b√∂ng√©sz≈ë nem tudott helyet k√©rni.
        Enged√©lyezd a helymeghat√°roz√°st.
      </div>
    </div>

    <div style="height:14px"></div>

    <div class="grid" id="poiList">

      <!-- P1 -->
      <div class="poi" id="p1">
        <div class="poi-head">
          <div>
            <div class="poi-title">1. Rossatz‚ÄìArnsdorf, Dunapart</div>
            <div class="coords">48.390832, 15.516668</div>
          </div>
          <div class="badges">
            <span class="badge"><span class="dot warn" data-dot="p1"></span><span data-badgetext="p1">m√©r√©s: v√°rakoz√°s</span></span>
            <span class="badge"><span class="dot warn"></span><span data-dist="p1">t√°vols√°g: ‚Äî</span></span>
          </div>
        </div>

        <div class="p">
          Wachau autentikus dunaparti indul√≥pontja,
          barack√ºltetv√©nyekkel √©s t√∂rt√©nelmi teraszokkal.
        </div>

        <div class="poibtns">
          <a class="btn btn-accent" href="p1.html">R√©szletek</a>
          <a class="btn btn-blue" href="https://maps.app.goo.gl/MwcjqNfXFLw3WBjA" target="_blank">üß≠ Navig√°ci√≥</a>
        </div>

        <img class="inline-image" src="images/RossatzArnsdorf.jpg" alt="Rossatz-Arnsdorf">
      </div>

      <!-- P2 -->
      <div class="poi" id="p2">
        <div class="poi-head">
          <div>
            <div class="poi-title">2. Melk ap√°ts√°g</div>
            <div class="coords">48.228300, 15.332600</div>
          </div>
          <div class="badges">
            <span class="badge"><span class="dot warn" data-dot="p2"></span><span data-badgetext="p2">m√©r√©s: v√°rakoz√°s</span></span>
            <span class="badge"><span class="dot warn"></span><span data-dist="p2">t√°vols√°g: ‚Äî</span></span>
          </div>
        </div>

        <div class="p">
          Monument√°lis barokk benc√©s ap√°ts√°g a Duna felett,
          Ausztria egyik legismertebb √©p√ºlete.
        </div>

        <div class="poibtns">
          <a class="btn btn-accent" href="p2.html">R√©szletek</a>
          <a class="btn btn-blue" href="https://maps.app.goo.gl/4dVPr1z7G9rZK9Ww9" target="_blank">üß≠ Navig√°ci√≥</a>
        </div>

        <img class="inline-image" src="images/Melk.jpg" alt="Melk ap√°ts√°g">
      </div>

      <!-- P3 -->
      <div class="poi" id="p3">
        <div class="poi-head">
          <div>
            <div class="poi-title">3. Grein</div>
            <div class="coords">48.226894, 14.852718</div>
          </div>
          <div class="badges">
            <span class="badge"><span class="dot warn" data-dot="p3"></span><span data-badgetext="p3">m√©r√©s: v√°rakoz√°s</span></span>
            <span class="badge"><span class="dot warn"></span><span data-dist="p3">t√°vols√°g: ‚Äî</span></span>
          </div>
        </div>

        <div class="p">
          Hangulatos dunai kisv√°ros,
          kast√©llyal √©s Ausztria legr√©gebbi sz√≠nh√°z√°val.
        </div>

        <div class="poibtns">
          <a class="btn btn-accent" href="p3.html">R√©szletek</a>
          <a class="btn btn-blue" href="https://maps.app.goo.gl/QLxBZA7Vg7stKeBCA" target="_blank">üß≠ Navig√°ci√≥</a>
        </div>

        <img class="inline-image" src="images/Grein.jpg" alt="Grein">
      </div>

      <!-- P4 -->
      <div class="poi" id="p4">
        <div class="poi-head">
          <div>
            <div class="poi-title">4. Waidhofen an der Ybbs ‚Äì √≥v√°ros</div>
            <div class="coords">47.960634, 14.774023</div>
          </div>
          <div class="badges">
            <span class="badge"><span class="dot warn" data-dot="p4"></span><span data-badgetext="p4">m√©r√©s: v√°rakoz√°s</span></span>
            <span class="badge"><span class="dot warn"></span><span data-dist="p4">t√°vols√°g: ‚Äî</span></span>
          </div>
        </div>

        <div class="p">
          K√∂z√©pkori v√°rosmag,
          vasipari m√∫lt √©s mark√°ns v√°rosfalak.
        </div>

        <div class="poibtns">
          <a class="btn btn-accent" href="p4.html">R√©szletek</a>
        </div>

        <img class="inline-image" src="images/WaidhofenanderYbbs.jpg" alt="Waidhofen">
      </div>

      <!-- P5 -->
      <div class="poi" id="p5">
        <div class="poi-head">
          <div>
            <div class="poi-title">5. Traunsee</div>
            <div class="coords">47.918163, 13.802318</div>
          </div>
          <div class="badges">
            <span class="badge"><span class="dot warn" data-dot="p5"></span><span data-badgetext="p5">m√©r√©s: v√°rakoz√°s</span></span>
            <span class="badge"><span class="dot warn"></span><span data-dist="p5">t√°vols√°g: ‚Äî</span></span>
          </div>
        </div>

        <div class="p">
          Ausztria legm√©lyebb tava,
          meredek hegyekkel √©s fjordszer≈± l√°tv√°nnyal.
        </div>

        <div class="poibtns">
          <a class="btn btn-accent" href="p5.html">R√©szletek</a>
        </div>

        <img class="inline-image" src="images/Traunsee.jpg" alt="Traunsee">
      </div>

      <!-- P6 -->
      <div class="poi" id="p6">
        <div class="poi-head">
          <div>
            <div class="poi-title">6. Ort v√≠zikast√©ly</div>
            <div class="coords">47.910645, 13.790349</div>
          </div>
          <div class="badges">
            <span class="badge"><span class="dot warn" data-dot="p6"></span><span data-badgetext="p6">m√©r√©s: v√°rakoz√°s</span></span>
            <span class="badge"><span class="dot warn"></span><span data-dist="p6">t√°vols√°g: ‚Äî</span></span>
          </div>
        </div>

        <div class="p">
          Szigetre √©p√ºlt renesz√°nsz kast√©ly,
          ikonikus fot√≥pont Gmundenn√©l.
        </div>

        <div class="poibtns">
          <a class="btn btn-accent" href="p6.html">R√©szletek</a>
        </div>

        <img class="inline-image" src="images/Ortvizikastely.jpg" alt="Schloss Ort">
      </div>

      <!-- P7 -->
      <div class="poi" id="p7">
        <div class="poi-head">
          <div>
            <div class="poi-title">7. Bad Ischl ‚Äì Kaiservilla</div>
            <div class="coords">47.713941, 13.620722</div>
          </div>
          <div class="badges">
            <span class="badge"><span class="dot warn" data-dot="p7"></span><span data-badgetext="p7">m√©r√©s: v√°rakoz√°s</span></span>
            <span class="badge"><span class="dot warn"></span><span data-dist="p7">t√°vols√°g: ‚Äî</span></span>
          </div>
        </div>

        <div class="p">
          A Habsburg Monarchia ny√°ri f≈ëv√°rosa,
          Ferenc J√≥zsef kedvelt rezidenci√°ja.
        </div>

        <div class="poibtns">
          <a class="btn btn-accent" href="p7.html">R√©szletek</a>
        </div>

        <img class="inline-image" src="images/BadIschl.jpg" alt="Bad Ischl">
      </div>

      <!-- P8 -->
      <div class="poi" id="p8">
        <div class="poi-head">
          <div>
            <div class="poi-title">8. Szent Wolfgang-templom</div>
            <div class="coords">47.738186, 13.447891</div>
          </div>
          <div class="badges">
            <span class="badge"><span class="dot warn" data-dot="p8"></span><span data-badgetext="p8">m√©r√©s: v√°rakoz√°s</span></span>
            <span class="badge"><span class="dot warn"></span><span data-dist="p8">t√°vols√°g: ‚Äî</span></span>
          </div>
        </div>

        <div class="p">
          G√≥tikus zar√°ndoktemplom Michael Pacher olt√°r√°val
          a Wolfgangsee partj√°n.
        </div>

        <div class="poibtns">
          <a class="btn btn-accent" href="p8.html">R√©szletek</a>
        </div>

        <img class="inline-image" src="images/SzentWolfgang.jpg" alt="Szent Wolfgang">
      </div>

      <!-- P9 -->
      <div class="poi" id="p9">
        <div class="poi-head">
          <div>
            <div class="poi-title">9. Fuschlsee</div>
            <div class="coords">47.792000, 13.298800</div>
          </div>
          <div class="badges">
            <span class="badge"><span class="dot warn" data-dot="p9"></span><span data-badgetext="p9">m√©r√©s: v√°rakoz√°s</span></span>
            <span class="badge"><span class="dot warn"></span><span data-dist="p9">t√°vols√°g: ‚Äî</span></span>
          </div>
        </div>

        <div class="p">
          Smaragdz√∂ld viz≈± alpesi t√≥,
          Salzburg tartom√°ny egyik rejtett kincse.
        </div>

        <div class="poibtns">
          <a class="btn btn-accent" href="p9.html">R√©szletek</a>
        </div>

        <img class="inline-image" src="images/Fuschlsee.jpg" alt="Fuschlsee">
      </div>

      <!-- P10 -->
      <div class="poi" id="p10">
        <div class="poi-head">
          <div>
            <div class="poi-title">10. Wiestalstausee</div>
            <div class="coords">47.676100, 13.074300</div>
          </div>
          <div class="badges">
            <span class="badge"><span class="dot warn" data-dot="p10"></span><span data-badgetext="p10">m√©r√©s: v√°rakoz√°s</span></span>
            <span class="badge"><span class="dot warn"></span><span data-dist="p10">t√°vols√°g: ‚Äî</span></span>
          </div>
        </div>

        <div class="p">
          T√°jv√©delmi v√≠zt√°roz√≥ Salzburg k√∂zel√©ben,
          erd≈ëkkel √©s hegyekkel k√∂r√ºlv√©ve.
        </div>

        <div class="poibtns">
          <a class="btn btn-accent" href="p10.html">R√©szletek</a>
        </div>

        <img class="inline-image" src="images/Wiestalstausee.jpg" alt="Wiestalstausee">
      </div>

      <!-- P11 -->
      <div class="poi" id="p11">
        <div class="poi-head">
          <div>
            <div class="poi-title">11. Unken ‚Äì Saalachtal</div>
            <div class="coords">47.676100, 13.074300</div>
          </div>
          <div class="badges">
            <span class="badge"><span class="dot warn" data-dot="p11"></span><span data-badgetext="p11">m√©r√©s: v√°rakoz√°s</span></span>
            <span class="badge"><span class="dot warn"></span><span data-dist="p11">t√°vols√°g: ‚Äî</span></span>
          </div>
        </div>

        <div class="p">
          Berchtesgadeni Alpok kapuja,
          szorosokkal √©s vad hegyvid√©kkel.
        </div>

        <div class="poibtns">
          <a class="btn btn-accent" href="p11.html">R√©szletek</a>
        </div>

        <img class="inline-image" src="images/Saalachtal.png" alt="Saalachtal">
      </div>

      <!-- P12 -->
      <div class="poi" id="p12">
        <div class="poi-head">
          <div>
            <div class="poi-title">12. Camping M√ºhlleiten ‚Äì Lofer</div>
            <div class="coords">47.599781, 12.988963</div>
          </div>
          <div class="badges">
            <span class="badge"><span class="dot warn" data-dot="p12"></span><span data-badgetext="p12">m√©r√©s: v√°rakoz√°s</span></span>
            <span class="badge"><span class="dot warn"></span><span data-dist="p12">t√°vols√°g: ‚Äî</span></span>
          </div>
        </div>

        <div class="p">
          Motorosbar√°t alpesi kemping,
          t√∂k√©letes napz√°r√°s a Saalachtalban.
        </div>

        <div class="poibtns">
          <a class="btn btn-accent" href="p12.html">R√©szletek</a>
          <a class="btn btn-blue" href="https://maps.app.goo.gl/2GLs3rVT3cS5VFFo7" target="_blank">üß≠ Navig√°ci√≥</a>
        </div>

        <img class="inline-image" src="images/CampingM√ºhlleiten.jpg" alt="Camping M√ºhlleiten">
      </div>

    </div>
  </div>
</div>

<script>
const POIS = [
  {id:"p1",lat:48.390832,lon:15.516668},
  {id:"p2",lat:48.2283,lon:15.3326},
  {id:"p3",lat:48.226894,lon:14.852718},
  {id:"p4",lat:47.960634,lon:14.774023},
  {id:"p5",lat:47.918163,lon:13.802318},
  {id:"p6",lat:47.910645,lon:13.790349},
  {id:"p7",lat:47.713941,lon:13.620722},
  {id:"p8",lat:47.738186,lon:13.447891},
  {id:"p9",lat:47.792,lon:13.2988},
  {id:"p10",lat:47.6761,lon:13.0743},
  {id:"p11",lat:47.6761,lon:13.0743},
  {id:"p12",lat:47.599781,lon:12.988963}
];

let sample1 = null;
let t2 = null;

function haversineKm(lat1, lon1, lat2, lon2) {
  const R = 6371;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a =
    Math.sin(dLat/2)**2 +
    Math.cos(lat1*Math.PI/180) * Math.cos(lat2*Math.PI/180) * Math.sin(dLon/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

function setBadge(id, txt){
  const el = document.querySelector(`[data-badgetext="${id}"]`);
  if(el) el.textContent = txt;
}

function setDist(id, km){
  const el = document.querySelector(`[data-dist="${id}"]`);
  if(el) el.textContent = `t√°vols√°g: ${km.toFixed(2)} km`;
}

function computeDistances(pos){
  const out = {};
  POIS.forEach(p=>{
    out[p.id] = haversineKm(pos.lat, pos.lon, p.lat, p.lon);
  });
  return out;
}

function scrollToPoi(id){
  const el = document.getElementById(id);
  if(el) el.scrollIntoView({behavior:"smooth", block:"center"});
}

function pickTarget(d1, d2, moveKm){
  if(moveKm < 0.03) {
    let best = null;
    for(const id in d2){
      if(!best || d2[id] < best.km) best = {id, km:d2[id]};
    }
    return best ? best.id : null;
  }

  let best = null;
  for(const id in d2){
    const delta = (d1 && d1[id] != null) ? (d1[id] - d2[id]) : 0;
    const score = delta;
    if(!best) best = {id, score, km:d2[id]};
    else {
      if(score > best.score + 1e-9) best = {id, score, km:d2[id]};
      else if(Math.abs(score - best.score) < 1e-9 && d2[id] < best.km) best = {id, score, km:d2[id]};
    }
  }
  return best ? best.id : null;
}

function updateUI(distances){
  for(const id in distances){
    setDist(id, distances[id]);
    setBadge(id, "m√©rve");
  }
}

function getPosOnce(){
  return new Promise((resolve, reject)=>{
    if(!navigator.geolocation){
      reject(new Error("Geolocation not supported"));
      return;
    }
    navigator.geolocation.getCurrentPosition(
      p => resolve({lat:p.coords.latitude, lon:p.coords.longitude}),
      e => reject(e),
      { enableHighAccuracy:true, maximumAge:0, timeout:12000 }
    );
  });
}

async function runMeasureCycle(scrollAfter=true){
  if(t2) { clearTimeout(t2); t2 = null; }
  document.getElementById("gpsNotice").style.display = "none";

  try{
    const posA = await getPosOnce();
    const dA = computeDistances(posA);
    updateUI(dA);
    sample1 = {pos:posA, d:dA};

    if(scrollAfter){
      const nearestA = Object.keys(dA).reduce((best,id)=> !best || dA[id] < dA[best] ? id : best, null);
      if(nearestA) scrollToPoi(nearestA);
    }

    t2 = setTimeout(async ()=>{
      try{
        const posB = await getPosOnce();
        const dB = computeDistances(posB);
        updateUI(dB);

        const moveKm = haversineKm(sample1.pos.lat, sample1.pos.lon, posB.lat, posB.lon);
        const target = pickTarget(sample1.d, dB, moveKm);
        if(target) scrollToPoi(target);

      } catch(err2){
        document.getElementById("gpsNotice").style.display = "block";
      }
    }, 5000);

  } catch(err){
    document.getElementById("gpsNotice").style.display = "block";
  }
}

runMeasureCycle(true);

document.getElementById("btnNearest").addEventListener("click", ()=>{
  runMeasureCycle(true);
});
</script>

</body>
</html>
